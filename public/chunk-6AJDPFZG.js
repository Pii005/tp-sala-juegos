import{F,I as k,K as M,L as P,N as K,R as O,U as v,W as R,X as te,Y as f,Z as re,_ as L,a as b,ba as U,c as Y,ca as ie,d as Z,da as T,e as $,ea as D,f as y,fa as g,g as ee,ga as N,ha as A,i as s,ia as j,j as u,k as c,ka as _,l,m as o,ma as q,n,na as V,o as d,oa as G,p as S,q as w,r as h,s as p,sa as z,t as a,ta as W,v as J,z as I}from"./chunk-VR3QZDNK.js";var x=class r{constructor(t){this.firestore=t}checkIfUserExists(t){return b(this,null,function*(){let e=f(this.firestore,"Usuarios"),i=U(e,T("user","==",t));return!(yield L(i)).empty})}static \u0275fac=function(e){return new(e||r)($(v))};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};function ge(r,t){r&1&&(o(0,"small",14),a(1,"El email es requerido"),n())}function de(r,t){r&1&&(o(0,"small",14),a(1,"Formato incorrecto"),n())}function pe(r,t){if(r&1&&(S(0),c(1,ge,2,0,"small",13)(2,de,2,0,"small",13),w()),r&2){let e=p();s(),l("ngIf",e.email==null?null:e.email.hasError("required")),s(),l("ngIf",e.email==null?null:e.email.hasError("email"))}}function fe(r,t){r&1&&(S(0),o(1,"small",14),a(2,"El email no est\xE1 registrado"),n(),w())}function he(r,t){r&1&&(o(0,"small",14),a(1,"La contrase\xF1a es requerida"),n())}function be(r,t){if(r&1&&(o(0,"small",14),a(1),n()),r&2){let e=p(2);s(),J("M\xEDnimo ",e.contra==null?null:e.contra.getError("minlength").requiredLength," caracteres")}}function ve(r,t){if(r&1&&(S(0),c(1,he,2,0,"small",13)(2,be,2,1,"small",13),w()),r&2){let e=p();s(),l("ngIf",e.contra==null?null:e.contra.hasError("required")),s(),l("ngIf",e.contra==null?null:e.contra.hasError("minlength"))}}function _e(r,t){if(r&1&&(o(0,"div",15),a(1),n()),r&2){let e=p();s(),J(" ",e.msgError," ")}}var B=class r{constructor(t,e,i,m){this.router=t;this.auth=e;this.firestore=i;this.userCheckService=m}form;newEmail="";newContrase="";loggesUser="";flagError=!1;msgError="";countLogins=0;sub;loginsCollection=[];ngOnInit(){console.log("Ingresando..."),this.form=new j({email:new _("",[g.required,g.email]),contra:new _("",[g.required])})}goTo(t){this.router.navigate([t])}enviarForm(){return b(this,null,function*(){if(this.flagError=!1,this.form.valid){let t=this.form.get("email")?.value,e=this.form.get("contra")?.value;(yield this.verifyUser(t))?yield this.loginUser(t,e):(this.msgError="El usuario no existe.",this.flagError=!0)}else this.msgError="Formulario inv\xE1lido",this.flagError=!0})}verifyUser(t){return b(this,null,function*(){return yield this.userCheckService.checkIfUserExists(t)})}loginUser(t,e){let i=f(this.firestore,"Usuarios"),m=R(i);this.sub=m.subscribe(C=>{this.loginsCollection=C;let E=this.loginsCollection.find(H=>H.user===t);E?E.contrasenia===e?(localStorage.setItem("userEmail",t),this.router.navigate(["home"],{state:{email:t}})):(this.msgError="Contrase\xF1a incorrecta.",this.flagError=!0):(this.msgError="El usuario no existe",this.flagError=!0)})}updateLastLogin(t){return b(this,null,function*(){try{let e=f(this.firestore,"Usuarios"),i=U(e,T("user","==",t)),m=yield L(i);if(m.empty)console.log("Usuario no encontrado para actualizar la fecha.");else{let C=m.docs[0],E=re(this.firestore,"user",C.id);yield ie(E,{ultimaSesion:new Date}),console.log("\xDAltima fecha de sesi\xF3n actualizada con \xE9xito.")}}catch(e){console.error("Error al actualizar la fecha de la \xFAltima sesi\xF3n:",e)}})}get email(){return this.form.get("email")}get contra(){return this.form.get("contra")}static \u0275fac=function(e){return new(e||r)(u(P),u(O),u(v),u(x))};static \u0275cmp=y({type:r,selectors:[["app-login"]],standalone:!0,features:[I],decls:25,vars:5,consts:[[1,"formulario"],[1,"login-container"],[3,"ngSubmit","formGroup"],[1,"ingresos"],["for","email"],["type","email","formControlName","email",1,"input-field"],[4,"ngIf"],["for","contra"],["type","password","formControlName","contra",1,"input-field"],["class","error-message",4,"ngIf"],["type","submit",1,"btn","btn-submit"],[1,"button-container"],["type","button",1,"btn","btn-regis",3,"click"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"error-message"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"form",2),h("ngSubmit",function(){return i.enviarForm()}),o(3,"h2"),a(4,"Iniciar sesion"),n(),o(5,"div",3)(6,"label",4),a(7,"Email"),n(),d(8,"input",5),c(9,pe,3,2,"ng-container",6)(10,fe,3,0,"ng-container",6),n(),o(11,"div",3)(12,"label",7),a(13,"Contrase\xF1a"),n(),d(14,"input",8),c(15,ve,3,2,"ng-container",6),n(),c(16,_e,2,1,"div",9),o(17,"button",10),a(18,"Ingresar"),n(),o(19,"div",11)(20,"button",12),h("click",function(){return i.goTo("auth/register")}),a(21,"Registrarse"),n(),o(22,"button",12),h("click",function(){return i.goTo("home")}),a(23,"Volver"),n()()()()(),d(24,"router-outlet")),e&2&&(s(2),l("formGroup",i.form),s(7),l("ngIf",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),s(),l("ngIf",(i.email==null?null:i.email.hasError("emailNotExists"))&&(i.email==null?null:i.email.touched)),s(5),l("ngIf",(i.contra==null?null:i.contra.invalid)&&(i.contra==null?null:i.contra.touched)),s(),l("ngIf",i.flagError))},dependencies:[M,k,F,z,q,D,N,A,W,V,G],styles:[".formulario[_ngcontent-%COMP%]{overflow:hidden;font-family:Arial,sans-serif;background:#373b44;background:-webkit-linear-gradient(to right,#4286f4,#373B44);background:linear-gradient(to right,#4286f4,#373b44);height:100vh;display:flex;justify-content:center;align-items:center;margin:0}.login-container[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px #0000001a;width:80%;max-width:600px;display:flex;flex-direction:column}.login-text[_ngcontent-%COMP%]{flex:1;text-align:left;padding-right:40px}h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px}.login-form[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.input-field[_ngcontent-%COMP%]{padding:12px;margin:10px 0;border:1px solid #ccc;border-radius:4px;width:100%}.ingresos[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.form-control[_ngcontent-%COMP%]{padding:12px;margin:0;border:1px solid #ccc;border-radius:4px;width:100%}.btn[_ngcontent-%COMP%]{padding:12px;background-color:#4079d5;color:#fff;border:none;border-radius:4px;cursor:pointer;width:100%;margin-bottom:10px}.btn[_ngcontent-%COMP%]:hover{background-color:#2f60ae}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.btn-regis[_ngcontent-%COMP%]{width:48%;background-color:#759ad7}.btn-regis[_ngcontent-%COMP%]{padding:10px;width:45%;background-color:#759ad7;align-self:center;border:none;border-radius:4px;color:#fff;cursor:pointer;margin-left:10px;margin-right:0;margin-top:10px}.error-message[_ngcontent-%COMP%]{color:red}"]})};function xe(r,t){r&1&&(o(0,"span"),a(1,"El campo de email es obligatorio."),n())}function Ce(r,t){r&1&&(o(0,"span"),a(1,"Por favor, ingresa un email v\xE1lido."),n())}function Ee(r,t){r&1&&(o(0,"span"),a(1,"El email ya est\xE1 en uso."),n())}function ye(r,t){if(r&1&&(o(0,"div",12),c(1,xe,2,0,"span",13)(2,Ce,2,0,"span",13)(3,Ee,2,0,"span",13),n()),r&2){let e=p();s(),l("ngIf",e.email.errors.required),s(),l("ngIf",e.email.errors.email),s(),l("ngIf",e.email.errors.emailExists)}}function Se(r,t){r&1&&(o(0,"span"),a(1,"El campo de contrase\xF1a es obligatorio."),n())}function we(r,t){r&1&&(o(0,"span"),a(1,"La contrase\xF1a debe tener al menos 6 caracteres."),n())}function Ie(r,t){if(r&1&&(o(0,"div",12),c(1,Se,2,0,"span",13)(2,we,2,0,"span",13),n()),r&2){let e=p();s(),l("ngIf",e.contra.errors.required),s(),l("ngIf",e.contra.errors.minlength)}}var Q=class r{constructor(t,e,i,m){this.router=t;this.auth=e;this.firestore=i;this.userCheckService=m}form;loggesUser="";flagError=!1;msgError="";countLogins=0;sub;loginsCollection=[];goTo(t){this.router.navigate([t])}ngOnInit(){this.form=new j({email:new _("",[g.required,g.email],[this.emailExistsValidator.bind(this)]),contrasenia:new _("",[g.required,g.minLength(6)])})}emailExistsValidator(t){return t.value?this.userCheckService.checkIfUserExists(t.value).then(e=>e?{emailExists:!0}:null).catch(()=>null):Promise.resolve(null)}enviarForm(){this.msgError="",this.form.valid?(this.flagError=!1,this.registarUsuario()):(this.msgError=this.getFormErrors()||"Formulario inv\xE1lido",this.flagError=!0)}getFormErrors(){let t=this.email?.errors,e=this.contra?.errors;if(t){if(t.required)return"El campo de email es obligatorio.";if(t.email)return"Por favor, ingresa un email v\xE1lido.";if(t.emailExists)return"El email ya est\xE1 en uso."}if(e){if(e.required)return"El campo de contrase\xF1a es obligatorio.";if(e.minlength)return"La contrase\xF1a debe tener al menos 6 caracteres."}return""}registarUsuario(){let t=this.form.get("email")?.value,e=this.form.get("contrasenia")?.value;if(!this.form.valid){this.msgError="El formulario no es v\xE1lido.",this.flagError=!0;return}let i=f(this.firestore,"Usuarios"),m=R(i);this.sub=m.subscribe(C=>{if(this.loginsCollection=C,this.loginsCollection.filter(H=>H.user===t).length>0){this.msgError="El usuario ya existe",this.flagError=!0;return}else{this.flagError=!1,console.log("Creando Usuario..."),this.crearUsuario(t,e),this.sub.unsubscribe();return}})}crearUsuario(t,e){if(!t||!e){this.msgError="Por favor, ingresa el email y la contrase\xF1a.";return}let i=f(this.firestore,"Usuarios");te(i,{user:t,contrasenia:e,fecha:new Date,"ultimo ingreso":new Date}).then(()=>{localStorage.setItem("userEmail",t),console.log("Usuario creado y guardado en Firestore."),this.router.navigate(["home"],{state:{email:t}})}).catch(m=>{console.error("Error al crear el usuario en Firestore:",m)})}get email(){return this.form.get("email")}get contra(){return this.form.get("contrasenia")}static \u0275fac=function(e){return new(e||r)(u(P),u(O),u(v),u(x))};static \u0275cmp=y({type:r,selectors:[["app-register"]],standalone:!0,features:[I],decls:21,vars:3,consts:[[1,"formulario"],[1,"login-container"],[3,"ngSubmit","formGroup"],[1,"ingresos"],["for","email"],["id","email","formControlName","email",1,"input-field"],["class","error-message",4,"ngIf"],["for","contrasenia"],["id","contrasenia","type","password","formControlName","contrasenia",1,"input-field"],[1,"button-container"],["type","submit","type","button",1,"btn","btn-regis"],["type","button",1,"btn","btn-regis",3,"click"],[1,"error-message"],[4,"ngIf"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"form",2),h("ngSubmit",function(){return i.enviarForm()}),o(3,"h2"),a(4,"Registro"),n(),o(5,"div",3)(6,"label",4),a(7,"Email:"),n(),d(8,"input",5),c(9,ye,4,3,"div",6),n(),o(10,"div",3)(11,"label",7),a(12,"Contrase\xF1a:"),n(),d(13,"input",8),c(14,Ie,3,2,"div",6),n(),o(15,"div",9)(16,"button",10),a(17,"Registrar"),n(),o(18,"button",11),h("click",function(){return i.goTo("auth/login")}),a(19,"Volver"),n()()()()(),d(20,"router-outlet")),e&2&&(s(2),l("formGroup",i.form),s(7),l("ngIf",i.email&&i.email.errors&&(i.email.touched||i.email.dirty)),s(5),l("ngIf",i.contra&&i.contra.errors&&(i.contra.touched||i.contra.dirty)))},dependencies:[M,k,F,z,q,D,N,A,W,V,G],styles:[".formulario[_ngcontent-%COMP%]{overflow:hidden;font-family:Arial,sans-serif;background:#0f2027;background:-webkit-linear-gradient(to right,#2C5364,#203A43,#0F2027);background:linear-gradient(to right,#2c5364,#203a43,#0f2027);height:100vh;display:flex;justify-content:center;align-items:center;margin:0}.login-container[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px #0000001a;width:80%;max-width:600px;display:flex;flex-direction:column}.login-text[_ngcontent-%COMP%]{flex:1;text-align:left;padding-right:40px}h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px}.login-form[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.input-field[_ngcontent-%COMP%]{padding:12px;margin:10px 0;border:1px solid #ccc;border-radius:4px;width:100%}.ingresos[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.form-control[_ngcontent-%COMP%]{padding:12px;margin:0;border:1px solid #ccc;border-radius:4px;width:100%}.btn[_ngcontent-%COMP%]{padding:12px;background-color:#4079d5;color:#fff;border:none;border-radius:4px;cursor:pointer;width:100%;margin-bottom:10px}.btn[_ngcontent-%COMP%]:hover{background-color:#2f60ae}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.btn-regis[_ngcontent-%COMP%]{width:48%;background-color:#759ad7}.btn-regis[_ngcontent-%COMP%]{padding:10px;width:45%;background-color:#759ad7;align-self:center;border:none;border-radius:4px;color:#fff;cursor:pointer;margin-left:10px;margin-right:0;margin-top:10px}.error-message[_ngcontent-%COMP%]{color:red}"]})};var ae=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=ee({type:r});static \u0275inj=Z({imports:[K.forChild([{path:"login",component:B},{path:"register",component:Q}]),K]})};export{ae as AutenticacionModule};
